@{
    Layout = null;

    // culture info (C#5 safe)
    var uiLang = System.Threading.Thread.CurrentThread.CurrentUICulture.TwoLetterISOLanguageName;
    var isRtl = (uiLang == "ar");

    // Safe RouteData (NO ?. operator)
    var actionObj = ViewContext.RouteData.Values["action"];
    var controllerObj = ViewContext.RouteData.Values["controller"];
    var actionName = (actionObj == null) ? "Index" : actionObj.ToString();
    var controllerName = (controllerObj == null) ? "Home" : controllerObj.ToString();

    // Session user info (safe)
    var isAuthenticated = (Session["UserID"] != null);
    var firstName = GetSessionValue("FirstName", "");
    var lastName = GetSessionValue("LastName", "");
    var userName = isAuthenticated ? string.Format("{0} {1}", firstName, lastName).Trim() : "";

    var defaultUserImg = Url.Content("~/Images/UserDefault.png");
    var userImage = isAuthenticated ? GetSessionValue("UserImage", defaultUserImg) : defaultUserImg;

    var providerName = isAuthenticated ? GetSessionValue("Providername", "") : "";
    var branchName = isAuthenticated ? GetSessionValue("branchName", "") : "";
    var branchCode = isAuthenticated ? GetSessionValue("branchCode", "") : "";
    var userQrImage = GetSessionValue("UserqrImage", "");

    // Notifications flags
    var hasClaimFormApproved = GetSessionBoolValue("ClaimForm_Approved");
    var hasApproval = GetSessionBoolValue("Approval");
    var hasDoctorClaimForm = GetSessionBoolValue("Doctor_ClaimForm");
    var showNotifications = (hasClaimFormApproved || hasApproval || hasDoctorClaimForm);

    // Global resource helper (no strongly-typed classes needed)
    Func<string, string, string> T = (resFile, key) =>
    {
        try
        {
            var o = HttpContext.GetGlobalResourceObject(resFile, key);
            return (o == null) ? null : o.ToString();
        }
        catch { return null; }
    };

    var txtBrand = T("Layout", "Brand") ?? "MediGold Online";
    var txtMenu = T("Layout", "Menu") ?? "Menu";
    var txtAccount = T("Layout", "Account") ?? "Account";
    var txtSignOut = T("Layout", "SignOut") ?? "Sign Out";
    var txtLanguage = T("Layout", "Language") ?? "Language";
}

<!DOCTYPE html>
<html lang="@(isRtl ? "ar" : "en")" dir="@(isRtl ? "rtl" : "ltr")">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>@ViewBag.Title - @txtBrand</title>

    <!-- Bootstrap 5 -->
    @*<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />*@
    @*<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />*@
    @*<link rel="stylesheet" href="~/Content/vendor/bootstrap/css/bootstrap.min.css" />*@
    @*<link rel="stylesheet" href="~/Content/vendor/bootstrap-icons/fonts/bootstrap-icons.css" />*@
    <link rel="stylesheet" href="~/Content/vendor/bootstrap/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/Content/vendor/bootstrap-icons/bootstrap-icons.min.css" />
    <!-- IMPORTANT: do NOT use @Styles.Render("~/Content/css") here -->
    <link rel="stylesheet" href="~/Content/site.css" />
    <link rel="stylesheet" href="~/Content/layoutv2.css" />

    <link rel="icon" href="~/Images/qqqq.jpg" type="image/x-icon" />

    @RenderSection("head", required: false)
</head>

<body>


    <div class="snackbar">
        <a href="@Url.Action("ProviderClaimFormApproved","ClaimForm")" target="_self">

            <img class="snackbar-icon" src="~/Images/snackbar.png" />
            <div class="snackbar-text">
                <h2 class="snackbar-text-heading">Reiceve Approval From CMC!</h2>
                <p class="snackbar-text-paragraph"></p>
                <p class="snackbar-text-paragraph"></p>
                <p class="snackbar-text-paragraph">Card Number : <p1 id="CardNumbersnackbar"></p1> </p>
                <p class="snackbar-text-paragraph">Claim Form : <p1 id="Claimformsnackbar"></p1> </p>
            </div>
        </a>

        <svg class="snackbar-close-btn"
             width="22"
             height="22"
             viewBox="0 0 22 22"
             fill="none"
             xmlns="http://www.w3.org/2000/svg">
            <circle opacity="0.12" cx="11" cy="11" r="10" fill="red" />
            <path fill-rule="evenodd"
                  clip-rule="evenodd"
                  d="M1.75 11C1.75 5.89137 5.89137 1.75 11 1.75C16.1086 1.75 20.25 5.89137 20.25 11C20.25 16.1086 16.1086 20.25 11 20.25C5.89137 20.25 1.75 16.1086 1.75 11ZM11 0.25C5.06294 0.25 0.25 5.06294 0.25 11C0.25 16.9371 5.06294 21.75 11 21.75C16.9371 21.75 21.75 16.9371 21.75 11C21.75 5.06294 16.9371 0.25 11 0.25ZM8.53033 7.46967C8.23744 7.17678 7.76256 7.17678 7.46967 7.46967C7.17678 7.76256 7.17678 8.23744 7.46967 8.53033L9.93934 11L7.46967 13.4697C7.17678 13.7626 7.17678 14.2374 7.46967 14.5303C7.76256 14.8232 8.23744 14.8232 8.53033 14.5303L11 12.0607L13.4697 14.5303C13.7626 14.8232 14.2374 14.8232 14.5303 14.5303C14.8232 14.2374 14.8232 13.7626 14.5303 13.4697L12.0607 11L14.5303 8.53033C14.8232 8.23744 14.8232 7.76256 14.5303 7.46967C14.2374 7.17678 13.7626 7.17678 13.4697 7.46967L11 9.93934L8.53033 7.46967Z"
                  fill="red" />
        </svg>
    </div>


    <div class="snackbarMember">
        <a href="@Url.Action("MemberSmartCardRequests","ClaimForm")" target="_self">

            <img class="snackbarMember-icon" src="~/Images/snackbar.png" />
            <div class="snackbarMember-text">
                <h2 class="snackbarMember-text-heading">Reiceve Smart Card Requests From Member!</h2>
                <p class="snackbarMember-text-paragraph"></p>
                <p class="snackbarMember-text-paragraph"></p>
                <p class="snackbarMember-text-paragraph">Card Number : <p1 id="CardNumbersnackbarMember"></p1> </p>
            </div>
        </a>

        <svg class="snackbarMember-close-btn"
             width="22"
             height="22"
             viewBox="0 0 22 22"
             fill="none"
             xmlns="http://www.w3.org/2000/svg">
            <circle opacity="0.12" cx="11" cy="11" r="10" fill="red" />
            <path fill-rule="evenodd"
                  clip-rule="evenodd"
                  d="M1.75 11C1.75 5.89137 5.89137 1.75 11 1.75C16.1086 1.75 20.25 5.89137 20.25 11C20.25 16.1086 16.1086 20.25 11 20.25C5.89137 20.25 1.75 16.1086 1.75 11ZM11 0.25C5.06294 0.25 0.25 5.06294 0.25 11C0.25 16.9371 5.06294 21.75 11 21.75C16.9371 21.75 21.75 16.9371 21.75 11C21.75 5.06294 16.9371 0.25 11 0.25ZM8.53033 7.46967C8.23744 7.17678 7.76256 7.17678 7.46967 7.46967C7.17678 7.76256 7.17678 8.23744 7.46967 8.53033L9.93934 11L7.46967 13.4697C7.17678 13.7626 7.17678 14.2374 7.46967 14.5303C7.76256 14.8232 8.23744 14.8232 8.53033 14.5303L11 12.0607L13.4697 14.5303C13.7626 14.8232 14.2374 14.8232 14.5303 14.5303C14.8232 14.2374 14.8232 13.7626 14.5303 13.4697L12.0607 11L14.5303 8.53033C14.8232 8.23744 14.8232 7.76256 14.5303 7.46967C14.2374 7.17678 13.7626 7.17678 13.4697 7.46967L11 9.93934L8.53033 7.46967Z"
                  fill="red" />
        </svg>
    </div>



    <style>
        /*@@import url("https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;800&display=swap");
        @@import url("https://fonts.googleapis.com/css2?family=Urbanist:wght@500&display=swap");*/

        @@import url("../Content/font@400.css");
        @@import url("../Content/font@500.css");

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Poppins", sans-serif;
        }

        body {
            height: 100vh;
            background: radial-gradient(circle, rgb(255, 255, 255) 70%, rgb(243, 243, 243) 100%);
            position: relative;
        }

        .snackbar {
            width: 400px;
            height: 150px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(124, 130, 141, 0.2);
            transition: transform 0.6s ease-out;
            position: fixed;
            z-index: 100;
            right: 30px;
            bottom: -80px;
            transform: translateY(90px);
        }

        @@media (max-width: 575.9px) {
            .snackbar {
                width: 240px;
                right: 16px;
            }
        }

        .snackbar.isShown {
            transform: translateY(-180px);
        }

        .snackbar-icon {
            max-width: 60px;
            position: absolute;
            top: 50%;
            left: 10px;
            transform: translateY(-50%);
        }

        @@media (max-width: 575.9px) {
            .snackbar-icon {
                display: none;
            }
        }

        .snackbar-text {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            left: 90px;
            font-size: 15px;
        }

        .snackbar-text-heading {
            margin-bottom: 8px;
            color: #000000;
            font-size: 16px;
            font-weight: 900;
        }

        .snackbar-text-paragraph {
            color: #34292e;
        }

        @@media (max-width: 575.9px) {
            .snackbar-text {
                left: 20px;
            }
        }

        .snackbar-close-btn {
            position: absolute;
            top: 50%;
            left: calc(100% - 10px);
            transform: translate(-100%, -50%);
            cursor: pointer;
        }

        @@media (max-width: 575.9px) {
            .snackbar-close-btn {
                top: 20px;
            }
        }

        .show-snackbar-btn {
            width: 160px;
            height: 160px;
            background: white;
            border-radius: 100%;
            box-shadow: 0 10px 25px rgba(124, 130, 141, 0.2);
            cursor: pointer;
            transition: all 0.25s ease-out;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

            .show-snackbar-btn:hover {
                transform: translate(-50%, calc(-50% - 5px));
            }

            .show-snackbar-btn img {
                max-width: 70%;
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
            }

        .jssecrets {
            text-decoration: none !important;
            padding: 16px;
            background: #ffc805;
            color: #000000;
            font-size: 1em;
            border-radius: 8px;
            font-family: "Poppins", sans-serif;
            box-shadow: 0px 4px 12px rgba(184, 144, 0, 0.1882352941), 0px 8px 24px rgba(184, 144, 0, 0.3764705882);
            position: absolute;
            bottom: 24px;
            right: 24px;
            transition: all 0.3s;
        }

            .jssecrets:hover {
                transform: translateY(-4px);
            }
    </style>

    <script>
        //const showSnackbarBtn = document.querySelector('.show-snackbar-btn');
        const snackbar = document.querySelector('.snackbar');
        const closeBtn = document.querySelector('.snackbar-close-btn');

        // Functions

        //const showSnackbar = (autohide) => {
        //    snackbar.classList.add('isShown');
        //    $('#CardNumber').text("12451245679")
        //    $('#Claimform').text("1201011564")
        //    if (autohide) {
        //        setTimeout(hideSnackbar, 5000);
        //    }
        //};

        const hideSnackbar = () => {
            snackbar.classList.remove('isShown');
        };

        // Event listeners

        //showSnackbarBtn.addEventListener('click', showSnackbar.bind(null, true));
        closeBtn.addEventListener('click', hideSnackbar);
    </script>

    <style>
        .snackbarMember {
            width: 400px;
            height: 150px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(124, 130, 141, 0.2);
            transition: transform 0.6s ease-out;
            position: fixed;
            z-index: 100;
            right: 30px;
            bottom: -80px;
            transform: translateY(90px);
        }

        @@media (max-width: 575.9px) {
            .snackbarMember {
                width: 240px;
                right: 16px;
            }
        }

        .snackbarMember.isShown {
            transform: translateY(-180px);
        }

        .snackbarMember-icon {
            max-width: 60px;
            position: absolute;
            top: 50%;
            left: 10px;
            transform: translateY(-50%);
        }

        @@media (max-width: 575.9px) {
            .snackbarMember-icon {
                display: none;
            }
        }

        .snackbarMember-text {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            left: 90px;
            font-size: 15px;
        }

        .snackbarMember-text-heading {
            margin-bottom: 8px;
            color: #000000;
            font-size: 16px;
            font-weight: 900;
        }

        .snackbarMember-text-paragraph {
            color: #34292e;
        }

        @@media (max-width: 575.9px) {
            .snackbarMember-text {
                left: 20px;
            }
        }

        .snackbarMember-close-btn {
            position: absolute;
            top: 50%;
            left: calc(100% - 10px);
            transform: translate(-100%, -50%);
            cursor: pointer;
        }

        @@media (max-width: 575.9px) {
            .snackbarMember-close-btn {
                top: 20px;
            }
        }

        .show-snackbarMember-btn {
            width: 160px;
            height: 160px;
            background: white;
            border-radius: 100%;
            box-shadow: 0 10px 25px rgba(124, 130, 141, 0.2);
            cursor: pointer;
            transition: all 0.25s ease-out;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

            .show-snackbarMember-btn:hover {
                transform: translate(-50%, calc(-50% - 5px));
            }

            .show-snackbarMember-btn img {
                max-width: 70%;
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
            }
            /* ===========================
   RTL support for Snackbars
   English (LTR): right
   Arabic  (RTL): left
   =========================== */

/* Desktop */
html[dir="rtl"] .snackbar,
html[dir="rtl"] .snackbarMember{
    right: auto !important;
    left: 30px !important;
}

/* Mobile */
@@media (max-width: 575.9px){
    html[dir="rtl"] .snackbar,
    html[dir="rtl"] .snackbarMember{
        right: auto !important;
        left: 16px !important;
    }
}

/* Close button position mirrored (اختياري لكنه أفضل) */
html[dir="rtl"] .snackbar-close-btn,
html[dir="rtl"] .snackbarMember-close-btn{
    left: 10px !important;
    right: auto !important;
    transform: translate(0, -50%) !important;
}

/* Mirror icon/text alignment inside snackbar (اختياري) */
html[dir="rtl"] .snackbar-icon,
html[dir="rtl"] .snackbarMember-icon{
    left: auto !important;
    right: 10px !important;
}

html[dir="rtl"] .snackbar-text,
html[dir="rtl"] .snackbarMember-text{
    left: auto !important;
    right: 90px !important;
    text-align: right;
}

@@media (max-width: 575.9px){
    html[dir="rtl"] .snackbar-text,
    html[dir="rtl"] .snackbarMember-text{
        right: 20px !important;
    }
}
    </style>
    <style>
        /* OLD style count: works when element is .fa-stack and we set data-count */
        .fa-stack[data-count] {
            position: relative;
        }

            .fa-stack[data-count]::after {
                position: absolute;
                right: -6px;
                top: -6px;
                content: attr(data-count);
                font-size: 12px;
                padding: 6px 8px;
                border-radius: 999px;
                line-height: 1;
                color: #fff;
                background: rgba(255, 0, 0, 0.85);
                font-weight: 900;
                min-width: 18px;
                text-align: center;
            }
    </style>
    <script>
        const snackbarMember = document.querySelector('.snackbarMember');
        const closeBtnd1 = document.querySelector('.snackbarMember-close-btn');
        const hideSnackbard1 = () => {
            snackbarMember.classList.remove('isShown');
        };
        closeBtnd1.addEventListener('click', hideSnackbard1);
    </script>
    <script>
        // =========================================
        // Unified badge counters (OLD + NEW)
        // =========================================
        window.setBadgeCount = function (elementId, count) {
            try {
                var el = document.getElementById(elementId);
                if (!el) return;

                var n = parseInt(count || 0, 10);
                if (isNaN(n)) n = 0;

                // NEW style: bootstrap badge <span class="badge">
                if (el.classList && el.classList.contains('badge')) {
                    if (n <= 0) {
                        el.style.display = 'none';
                        el.textContent = '0';
                    } else {
                        el.style.display = 'inline-block';
                        el.textContent = String(n);
                    }
                    return;
                }

                // OLD style: data-count attribute on fa-stack or any element
                if (n <= 0) {
                    el.removeAttribute('data-count');
                } else {
                    el.setAttribute('data-count', String(n));
                }
            } catch (e) { }
        };
    </script>
    @if (isAuthenticated)
    {
        <nav class="navbar navbar-dark app-navbar fixed-top">
            <div class="container-fluid">

                <!-- Mobile menu -->
                <button class="btn btn-link text-white d-md-none me-2 p-0" type="button"
                        data-bs-toggle="offcanvas" data-bs-target="#sidebarOffcanvas" aria-controls="sidebarOffcanvas">
                    <i class="bi bi-list fs-2"></i>
                </button>

                <a class="navbar-brand fw-bold" href="@Url.Action("DoctorHome", "ClaimForm")">@txtBrand</a>

                <div class="ms-auto d-flex align-items-center gap-2">

                    <!-- Language -->
                    <div class="dropdown">
                        <button class="btn btn-icon text-white dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" title="@txtLanguage">
                            <i class="bi bi-translate"></i>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li>
                                <a class="dropdown-item" href="@Url.Action(actionName, controllerName, new { lang = "en" })">English</a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="@Url.Action(actionName, controllerName, new { lang = "ar" })">العربية</a>
                            </li>
                        </ul>
                    </div>

                    <!-- Desktop sidebar toggle -->
                    <button class="btn btn-icon text-white d-none d-md-inline-flex" type="button" id="sidebarToggle" title="Toggle sidebar">
                        <i class="bi bi-layout-sidebar-inset fs-4"></i>
                    </button>

                    <!-- Notifications -->
                    @if (showNotifications)
                    {
                        if (hasClaimFormApproved)
                        {
                            <a class="btn btn-icon text-white position-relative" href="@Url.Action("ProviderClaimFormApproved", "ClaimForm")" title="Approved Claims">
                                <i class="bi bi-bell-fill fs-5"></i>
                                <span class="badge bg-danger position-absolute top-0 start-100 translate-middle"
                                      id="NotifactionCount" style="display:none;">0</span>
                            </a>
                        }

                        <a class="btn btn-icon text-white position-relative" href="@Url.Action("MemberSmartCardRequests", "ClaimForm")" title="Smart Card Requests">
                            <i class="bi bi-credit-card-2-front-fill fs-5"></i>
                            <span class="badge bg-warning position-absolute top-0 start-100 translate-middle"
                                  id="MemberSmartCardRequestsCount" style="display:none;">0</span>
                        </a>

                        if (hasClaimFormApproved || hasDoctorClaimForm)
                        {
                            <a class="btn btn-icon text-white position-relative" href="@Url.Action("Messanger", "ClaimForm")" title="Messages">
                                <i class="bi bi-chat-dots-fill fs-5"></i>
                                <span class="badge bg-info position-absolute top-0 start-100 translate-middle"
                                      id="MesaageCount" style="display:none;">0</span>
                            </a>
                        }
                    }

                    <!-- User dropdown -->
                    <div class="dropdown">
                        <button class="btn btn-icon text-white dropdown-toggle" type="button" id="userDropdown"
                                data-bs-toggle="dropdown" aria-expanded="false">
                            <img src="@userImage" alt="User" class="rounded-circle" style="width:32px;height:32px;object-fit:cover;" />
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                            <li><span class="dropdown-item-text small">@userName</span></li>
                            <li><hr class="dropdown-divider" /></li>
                            <li>
                                <a class="dropdown-item" href="@Url.Action("AccountData", "UserDatas")">
                                    <i class="bi bi-person-circle me-2"></i>@txtAccount
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="@Url.Action("login", "ClaimForm")">
                                    <i class="bi bi-box-arrow-right me-2"></i>@txtSignOut
                                </a>
                            </li>
                        </ul>
                    </div>

                </div>
            </div>
        </nav>

        <!-- Mobile Offcanvas Sidebar -->
        <div class="offcanvas offcanvas-start" tabindex="-1" id="sidebarOffcanvas" aria-labelledby="sidebarOffcanvasLabel">
            <div class="offcanvas-header text-white">
                <h5 class="offcanvas-title" id="sidebarOffcanvasLabel">@txtMenu</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>

            <div class="offcanvas-body p-0">
                <div class="user-profile-section p-3 border-bottom">
                    <div class="text-center mb-2">
                        <img src="@userImage" alt="User" class="rounded-circle mb-2"
                             style="width:80px;height:80px;object-fit:cover;" />
                        @if (!string.IsNullOrWhiteSpace(userQrImage))
                        {
                            <img src="@userQrImage" alt="QR" class="img-fluid mt-2" style="max-width:80px;" />
                        }
                    </div>

                    <h6 class="mb-1 text-center">@branchCode</h6>
                    <div class="small text-center">@providerName</div>
                    <div class="small text-center text-muted">@branchName</div>
                    <div class="small text-center fw-bold mt-1">@userName</div>
                </div>

                @Html.Partial("_NavMenuV2")
            </div>
        </div>

        <!-- Desktop Sidebar -->
        <aside class="sidebar-desktop" id="sidebarDesktop">
            <div class="user-profile-section p-3 border-bottom">
                <div class="text-center mb-2">
                    <img src="@userImage" alt="User" class="rounded-circle mb-2"
                         style="width:80px;height:80px;object-fit:cover;" />
                    @if (!string.IsNullOrWhiteSpace(userQrImage))
                    {
                        <img src="@userQrImage" alt="QR" class="img-fluid mt-2" style="max-width:80px;" />
                    }
                </div>

                <h6 class="mb-1 text-center small">@branchCode</h6>
                <div class="small text-center">@providerName</div>
                <div class="small text-center text-muted">@branchName</div>
                <div class="small text-center fw-bold mt-1">@userName</div>
            </div>

            @Html.Partial("_NavMenuV2")
        </aside>

        <!-- Main Content -->
        <main class="main-content" id="mainContent">
            <div class="container-fluid py-3">
                @RenderBody()
            </div>

            @*<footer class="footer py-3 bg-white border-top">
                    <div class="container-fluid text-center">
                        <span class="text-muted">&copy; @DateTime.Now.Year @txtBrand. All rights reserved.</span>
                    </div>
                </footer>*@
        </main>
    }
    else
    {
        <main class="main-content-public">
            <div class="container-fluid py-3">
                @RenderBody()
            </div>
        </main>
    }

    @*<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>*@
    @*<script src="~/Scripts/vendor/bootstrap/bootstrap.bundle.min.js"></script>*@
    <script src="~/Scripts/vendor/bootstrap/bootstrap.bundle.min.js"></script>

    <!-- OLD LAYOUT COMPATIBILITY -->
    @*<script src="~/Scripts/jquery-3.6.0.js"></script>*@
    <script src="~/Scripts/sweetalert2.all.min.js"></script>
    <link rel="stylesheet" href="~/Content/sweetalert2.min.css" />
    @*<link rel="stylesheet" href="~/Content/datatables.min.css" />*@
    @*<script src="~/Scripts/datatables.min.js"></script>*@
    @*<script src="~/Scripts/dataTables.fixedHeader.min.js"></script>*@
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var toggleBtn = document.getElementById('sidebarToggle');
            var sidebar = document.getElementById('sidebarDesktop');
            var mainContent = document.getElementById('mainContent');

            if (toggleBtn && sidebar && mainContent) {
                toggleBtn.addEventListener('click', function () {
                    sidebar.classList.toggle('collapsed');
                    mainContent.classList.toggle('sidebar-collapsed');
                });
            }

            var offcanvasElement = document.getElementById('sidebarOffcanvas');
            if (offcanvasElement) {
                var links = offcanvasElement.querySelectorAll('.nav-link');
                for (var i = 0; i < links.length; i++) {
                    links[i].addEventListener('click', function () {
                        if (window.innerWidth < 768) {
                            var inst = bootstrap.Offcanvas.getInstance(offcanvasElement);
                            if (inst) inst.hide();
                        }
                    });
                }
            }
        });
    </script>
    <script>
        // ===== Snackbars show/hide =====
        (function () {
            var snackbar = document.querySelector('.snackbar');
            var closeBtn = document.querySelector('.snackbar-close-btn');
            if (snackbar && closeBtn) {
                closeBtn.addEventListener('click', function () {
                    snackbar.classList.remove('isShown');
                });
            }

            var snackbarMember = document.querySelector('.snackbarMember');
            var closeBtnd1 = document.querySelector('.snackbarMember-close-btn');
            if (snackbarMember && closeBtnd1) {
                closeBtnd1.addEventListener('click', function () {
                    snackbarMember.classList.remove('isShown');
                });
            }

            // global helpers (لو صفحاتك بتناديها)
            window.hideSnackbar = function () {
                if (snackbar) snackbar.classList.remove('isShown');
            };
            window.hideSnackbard1 = function () {
                if (snackbarMember) snackbarMember.classList.remove('isShown');
            };
        })();

        // ===== Unified counters: supports BOTH old data-count and new bootstrap badge =====
        window.setBadgeCount = function (id, count) {
            try {
                var el = document.getElementById(id);
                if (!el) return;

                var n = parseInt(count || 0, 10);
                if (isNaN(n)) n = 0;

                // New layout: bootstrap badge (class="badge")
                if (el.classList && el.classList.contains('badge')) {
                    if (n <= 0) {
                        el.style.display = 'none';
                        el.textContent = '0';
                    } else {
                        el.style.display = 'inline-block';
                        el.textContent = String(n);
                    }
                    return;
                }

                // Old layout: data-count attribute
                if (window.jQuery) {
                    if (n <= 0) window.jQuery(el).removeAttr("data-count");
                    else window.jQuery(el).attr("data-count", n);
                } else {
                    // fallback بدون jQuery
                    if (n <= 0) el.removeAttribute('data-count');
                    else el.setAttribute('data-count', String(n));
                }
            } catch (e) { }
        };

        // Optional helpers: نفس أسماء دوال القديم (لو عندك صفحات بتنادي my_code)
        window.my_code = function (count) {
            setBadgeCount('NotifactionCount', count);
        };
    </script>
    @RenderSection("scripts", required: false)
</body>
</html>

@functions {
    string GetSessionValue(string key, string defaultValue)
    {
        try
        {
            var v = Session[key];
            return v == null ? defaultValue : v.ToString();
        }
        catch { return defaultValue; }
    }

    bool GetSessionBoolValue(string key)
    {
        try
        {
            var value = Session[key];
            if (value == null) return false;

            if (value is bool) return (bool)value;

            int i;
            if (int.TryParse(value.ToString(), out i)) return i == 1;

            bool pb;
            if (bool.TryParse(value.ToString(), out pb)) return pb;

            return false;
        }
        catch { return false; }
    }
}

@{
    ViewBag.Title = "Print_CancelClaimForm";
}


@Scripts.Render("~/bundles/bootstrap")
<script src="~/Scripts/jquery.signalR-2.4.3.min.js"></script>
<script src="~/signalr/hubs" type="text/javascript"></script>
@*<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet">*@
<script type="text/javascript" src="~/Scripts/bootstrap.bundle.min.js"></script>
<link rel="stylesheet" href="~/Content/bootstrapbundle.min.css">

<script src="~/Scripts/bootstrap.min.js"></script>
@*<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment-with-locales.min.js"></script>*@
<link rel="stylesheet" href="~/Content/select2.min.css">
<script type="text/javascript" src="~/Scripts/select2.min.js"></script>
<script type="text/javascript" src="~/Scripts/moment-with-locales.min.js"></script>


<input type="hidden" id="trigger" value="0" />
<input type="hidden" id="triggercount" value="0" />

<input type="hidden" id="trigger1" value="0" />
<input type="hidden" id="triggercount1" value="0" />

@Html.Hidden("Get", Url.Action("Get", "Customer"))
@Html.Hidden("Getmessages", Url.Action("Getmessages", "Customer"))
@Html.Hidden("Get1", Url.Action("Get1", "Customer"))


<script src="~/Scripts/daterangepicker.js"></script>
<link rel="stylesheet" href="~/Content/daterangepicker.css">


<style>
    /*body {
        margin: 0;
        padding: 0;
        background: #262626;
    }*/
    #backring1 {
        background-color: darkgray;
    }

    .ring1 {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%,-50%);
        width: 150px;
        height: 150px;
        background: transparent;
        border: 3px solid /*#3c3c3c*/ #9ac3b8;
        border-radius: 50%;
        text-align: center;
        line-height: 150px;
        font-family: sans-serif;
        font-size: 20px;
        color: /*#928d36*/ #fff000;
        letter-spacing: 4px;
        text-transform: uppercase;
        text-shadow: 0 0 10px #fff000;
        box-shadow: 0 0 20px rgba(0,0,0,.5);
        background-color: #11395c;
    }

        .ring1:before {
            content: '';
            position: absolute;
            top: 0px;
            left: 0px;
            width: 100%;
            height: 100%;
            border: 3px solid transparent;
            border-top: 3px solid #fff000;
            border-right: 3px solid #fff000;
            box-shadow: 0 0 1em white, 0 0 0 1000vw #e0dedeb5;
            border-radius: 50%;
            animation: animateC1 2s linear infinite;
        }

    spana1 {
        display: block;
        position: absolute;
        top: calc(50% - 2px);
        left: 50%;
        width: 50%;
        height: 4px;
        background: transparent;
        transform-origin: left;
        animation: animate1 2s linear infinite;
    }

        spana1:before {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #fff000;
            top: -6px;
            right: -8px;
            box-shadow: 0 0 20px #fff000;
        }

    @@keyframes animateC1 {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }

    @@keyframes animate1 {
        0% {
            transform: rotate(45deg);
        }

        100% {
            transform: rotate(405deg);
        }
    }
</style>
<style>

    * {
        box-sizing: border-box;
    }

    /*body {
        margin: 0;
        padding: 0;
        font-size: 1rem;
        background-color: #f4f4f4;
        height: 100vh;
    }

    header {
        padding: 0;
        height: 56px;
    }

    nav {
        background: #1c2024;
        margin: 0;
        display: flex;
        padding: 16px 32px;
        color: white;
    }*/

    /*h1.nav-brand {
        margin: 0;
        padding: 0;
    }*/

    /*.container {
        margin-top: 32px;
        display: flex;
        flex-direction: column;
        width: 90vw;
        margin-left: auto;
        margin-right: auto;
    }

    .row {
        display: block;
        width: 100%;
        margin-bottom: 32px;
    }*/

    #daterange {
        width: 300px;
        margin-left: 16px;
        /*padding: 4px 8px;*/
        font-size: 20px;
        outline: none;
        border-radius: .7rem;
    }

    #Search {
        width: 200px;
        margin-left: 16px;
        padding: 4px 8px;
        font-size: 20px;
        outline: none;
        border-radius: .7rem;
    }

    #PrintAll {
        width: 300px;
        margin-left: 36px;
        text-align: center;
        /*padding: 4px 8px;*/
        font-size: 20px;
        /*outline: none;
        border-radius: .7rem;*/
    }
</style>


<style>

    #link {
        text-decoration: none;
        display: inline-block;
        padding: 8px 16px;
    }

        #link:hover {
            background-color: #ddd;
            color: black;
        }

    #link1 {
        text-decoration: none;
        display: inline-block;
        padding: 8px 16px;
    }

        #link1:hover {
            background-color: #ddd;
            color: black;
        }
    /*.previous {
        background-color: #f1f1f1;
        color: black;
    }

        .previous:hover {
            background-color: #ddd;
            color: black;
        }

    .next {
        background-color: #04AA6D;
        color: white;
    }*/

    .round {
        background-color: teal;
        color: white;
        border-radius: 50%;
    }
</style>
<style>
    /*body {
            background-image:url('../Images/login.jpg');
        }*/
    /*table1 {
        border: 1px solid black;
    }*/

    body.table789 {
        font-family: Arial;
        font-size: 10pt;
    }

    table.table789 {
        border: 1px solid #ccc;
        border-collapse: collapse;
        background-color: #fff;
    }

        table.table789 th {
            background-color: teal;
            color: white;
            font-weight: bold;
            font-size: 12pt;
        }

        table.table789 th, table.table789 td {
            padding: 5px;
            border: 1px solid #ccc;
            font-size: 12pt;
        }

        table.table789, table.table789 table td {
            border: 1px solid #ccc;
            font-size: 12pt;
        }

    body.table7899 {
        font-family: Arial;
        font-size: 11pt;
    }

    table.table7899 {
        border: 1px solid #ccc;
        border-collapse: collapse;
        background-color: #fff;
    }

        table.table7899 th {
            background-color: teal;
            color: white;
            font-weight: bold;
            font-size: 15pt;
        }

        table.table7899 th, table.table789 td {
            padding: 5px;
            border: 1px solid #ccc;
            font-size: 12pt;
            /*font-weight: bold;*/
        }

        table.table7899, table.table7899 table td {
            padding: 5px;
            border: 1px solid #ccc;
            font-size: 12pt;
            /*font-weight: bold;*/
            /*color: black;*/
        }

    body.table78991 {
        font-family: Arial;
        font-size: 9pt;
    }

    table.table78991 {
        border: 1px solid #ccc;
        border-collapse: collapse;
        background-color: #fff;
    }

        table.table78991 th {
            background-color: teal;
            color: white;
            font-weight: bold;
            font-size: 11pt;
        }

        table.table78991 th, table.table789 td {
            padding: 5px;
            border: 1px solid #ccc;
            font-size: 9pt;
            /*font-weight: bold;*/
        }

        table.table78991, table.table78991 table td {
            padding: 5px;
            border: 1px solid #ccc;
            font-size: 9pt;
            /*font-weight: bold;*/
            /*color: black;*/
        }

    #ProviderBranch {
        max-width: 450px;
    }

    #ClaimForm_Number {
        max-width: 900px;
    }

    #form_number, #Card_number, #ClaimForm_Number, #Date_Procedure, #Date_symptoms, #ICD_Number {
        font-size: 18px;
        color: black;
    }

    #providerName {
        font-size: 12px;
    }

    #Card_numberLabel {
        font-size: 18px;
        color: black;
    }

    #ClaimForm_NumberLabel {
        font-size: 18px;
        color: black;
    }

    legend.scheduler-border {
        width: inherit; /* Or auto */
        padding: 0 10px; /* To give a bit of padding on the left and right */
        border-bottom: none;
    }

    fieldset.scheduler-border {
        border: 1px groove #ddd !important;
        padding: 0 1.4em 1.4em 1.4em !important;
        margin: 0 0 1.5em 0 !important;
        -webkit-box-shadow: 5px 5px 5px 5px #700c0c;
        box-shadow: 1px 1px 1px 1px #700c0c;
    }

    #pagination {
        width: 100%;
        text-align: center;
    }

        #pagination ul li {
            display: inline;
            margin-left: 10px;
        }
</style>
<h2 style="color:teal;text-align:center">Print ClaimForm</h2>

<br />
<fieldset class="scheduler-border">
    <legend class="scheduler-border" style="color:teal">ClaimForm Data</legend>
    <br />
    @*<main class="container">*@
    <div @*class="row"*@ style="display:inline-block">
        <label style="font-size:20px" for="daterange">Select Date Range</label>
        <input type="text" name="daterange" id="daterange" class="daterange">
        <input type="submit" value="Search" id="Search" class="btn btn-primary">
    </div>
    @*</main>*@
    <br />
    <br />
    <br />

    <table class="table7899" id="ClaimFormTable" cellpadding="0" cellspacing="0">
        <thead>
            <tr>
                <th>Serial</th>
                <th>Claim ID</th>
                <th>ClaimForm Number</th>
                <th>Card Number</th>
                <th>Member Name</th>
                <th>Procedure Date</th>
                <th></th>
                <th></th>
                @*<th></th>*@
            </tr>
        </thead>

        <tbody></tbody>
    </table>

    <br />
    <div class="modal" id="myModal" role="dialog">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">

                <!-- Modal Header -->
                <div class="modal-header">
                    <h2 class="modal-title">Invoice Services</h2>
                    <button type="button" class="btn-close btn-danger" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">

                    <table class="table78991" id="ClaimServicesTable" cellpadding="0" cellspacing="0">
                        <thead>
                            <tr>
                                <th>Serial</th>
                                <th>Service Name</th>
                                <th>Service Qnt</th>
                                <th>Service Note</th>
                            </tr>
                        </thead>

                        <tbody></tbody>
                    </table>

                </div>
                <!-- Modal footer -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger btn-lg" data-bs-dismiss="modal">Close</button>
                </div>

            </div>
        </div>
    </div>
    <br />
    <div style="text-align:center" id="diagnosis">

        <input type="submit" value="Print All Invoices Pdf" id="PrintAll" class="btn btn-info btn-lg">
    </div>
    <br />

    @*<div style="text-align:left;display:inline-block;position:relative">
            <a id="link" class="round" href="@Url.Action("DoctorHome","ClaimForm")">&laquo; Back to Main Home</a>
        </div>
        @if (int.Parse(Session["Medical_Services"].ToString()) == 1)
        {
            <div style="text-align:right;display:inline-block;padding-left:720px;position:relative">
                <a id="link" class="round" href="@Url.Action("ClaimServices","ClaimForm")"> Go to Medical Services &raquo;</a>
            </div>
        }
        else if (int.Parse(Session["Doctor_ClaimForm"].ToString()) == 1)
        {
            <div style="text-align:right;display:inline-block;padding-left:720px;position:relative">
                <a id="link" class="round" href="@Url.Action("Doctor_ClaimForm","ClaimForm")"> Go to Doctor ClaimForm &raquo;</a>
            </div>
        }*@
    <br />

    <br />
</fieldset>
<br />

<div id="backring1">
    <div class="ring1" id="Loadingg">
        Loading
        <spana1></spana1>
    </div>
</div>




<script>
    $(document).ready(function () {
        $("#Loadingg").hide();

        $('#ClaimFormTable').DataTable({
            paging: true,
        });

        $('#ClaimServicesTable').DataTable({
            paging: false,
        });

        $("body").on("click", "#Search", function () {

            $("#Loadingg").show();

            $.get("/ClaimForm/GetClaimFormsDateRange", { id: $('#daterange').val() }, function (data) {
                $("#Loadingg").hide();

            var t = $('#ClaimFormTable').DataTable();
                t.rows().remove().draw();
                if (data == "Falsee") {
                    Swal.fire("Warning !", "Select A Valid Date Range Again", "warning");

                }
                else {
                    if (data.length != 0) {

                        serialll11 = 0;

                        for (var i = 0; i < data.length; i++) {

                            serialll11++;
                            var btnshow =  "<button type='button' class='btn btn-warning' data-bs-toggle='modal' data-bs-target='#myModal' style='text-align:center' onclick='show(this);'>Show</button>";
                            var btnPrint = "<button type='button' class='btn btn-success' style='text-align:center' onclick='Print(this);'>Print</button>";
                            var btnDelete ="<button type='button' class='btn btn-danger' style='text-align:center' onclick='Delete(this);'>Delete</button>";
                            //var btnEdit = "<button type='button' class='btn btn-success' data-bs-toggle='modal' data-bs-target='#myModal' onclick='edited(this);'>Edit</button>";

                            t.row.add([serialll11, data[i].ApprovalID, data[i].ClaimFormNum, data[i].CardNumber, data[i].MemberName, moment(data[i].ProcedureDate).format("DD-MM-YYYY")
                                //,data[i].TClaimAmt.toLocaleString('en-US', { minimumFractionDigits: 2 }), data[i].TDeductAmt.toLocaleString('en-US', { minimumFractionDigits: 2 })
                                , btnshow, btnPrint/*, btnDelete*/

                            ]).draw()
                                ;

                        }
                    }
                    else {
                        ////$("#ClaimForm_image").hide();
                        ////$("#Expended_services").hide();
                        //$("#imgpost").hide();
                        //$("#button_open_div").hide();
                        //$("#button_Close_div").hide();

                        //$("#Provider_services").hide();
                        //$("#Expended_services").hide();
                        //$("#Expended_services_Stoped").hide();
                        //$("#Expended_services_Done").hide();

                    }
                }
            })
        });


        $("body").on("click", "#PrintAll", function () {

            Swal.fire({
                title: "Confirm",
                imageUrl: "/Images/Quationimg.jpg",
                imageWidth: 550,
                imageHeight: 225,
                text: "Are you Sure you want to Print All Claim Forms Pdf?",
                showCancelButton: true,
                confirmButtonText: "Confirm",
                cancelButtonColor: "#700c0c"

            }).then((result) => {

            if (result.isConfirmed) {
            var table = $('#ClaimFormTable').DataTable();

            //const Claimids = [];
            //var array_index = 0;

            table.rows().every(function () {

                var Row = this.data();//store every row data in a variable

                //console.log(Row[1]);//show Row + Cell index
                var Approval_ID = Row[1];
                //Claimids[array_index] = Claim_ID;
                //array_index = array_index + 1;
                //$.get("/ClaimForm/GenerateReport_PrintInvoice", { typeOfReport: "PDF", ClaimId: Claim_ID }, function (data) {

                //})
                window.open('@Url.Action("GenerateReport_PrintClaimForm", "ClaimForm")?typeOfReport=PDF' + '&ApprovalID=' + Approval_ID, '_blank');
            });


                    }
                });

            //jQuery.ajaxSettings.traditional = true;
            //$.get("/ClaimForm/PrintAll_DateRange", { Claimids_print: Claimids }, function (data) {

            //})
        });


    });
    function show(button) {
        $("#Loadingg").show();

        //Determine the reference of the Row using the Button.
        //var row = $(button).closest("TR");
        var row = $(button).closest("TR");
        //.find("td")
        //Delete the Table row using it's Index.

        var rowindexx = row[0].rowIndex;
        //alert(row[0].cells.item(1).innerHTML);
        //var table = $('#ClaimFormTable').DataTable();

        //var ClaimID = table.cell(row[0].rowIndex - 1, 1).data();
        var ClaimID = row[0].cells.item(1).innerHTML;
        //alert($("TD", row).eq(1).html());
        //alert(ClaimID);
        var t1 = $('#ClaimServicesTable').DataTable();
        t1.rows().remove().draw();
        $.get("/ClaimForm/Get_Doctor_ClaimFormServices", { ApprovalID: ClaimID }, function (data) {
            $("#Loadingg").hide();

                if (data.length != 0) {
                    seria1 = 0;
                    for (var i = 0; i < data.length; i++) {
                        seria1++;
                        t1.row.add([seria1, data[i].ServiceName, data[i].ServiceQnt, data[i].ServiceNote
                        ]).draw()
                            ;

                    }
                }

        })



    }

    function Print(button) {
        //Determine the reference of the Row using the Button.

        Swal.fire({
            title: "Confirm",
            imageUrl: "/Images/Quationimg.jpg",
            imageWidth: 550,
            imageHeight: 225,
            text: "Are you Sure you want to Print Claim Form Pdf?",
            showCancelButton: true,
            confirmButtonText: "Confirm",
            cancelButtonColor: "#700c0c"
        }).then((result) => {
            if (result.isConfirmed) {
                var row = $(button).closest("TR");
                var Approval_ID = row[0].cells.item(1).innerHTML;
                window.open('@Url.Action("GenerateReport_PrintClaimForm", "ClaimForm")?typeOfReport=PDF' + '&ApprovalID=' + Approval_ID, '_self');

            }
        });
    }


    function Delete(button) {
        //Determine the reference of the Row using the Button.

        Swal.fire({
            title: "Confirm",
            imageUrl: "/Images/Quationimg.jpg",
            imageWidth: 550,
            imageHeight: 225,
            text: "Are you Sure you want to Delete Invoice?",
            showCancelButton: true,
            confirmButtonText: "Confirm",
            cancelButtonColor: "#700c0c"
        }).then((result) => {
            if (result.isConfirmed) {
                $("#Loadingg").show();

        var row = $(button).closest("TR");
        var ClaimID = row[0].cells.item(1).innerHTML;

        $.get("/ClaimForm/Delete_Invoice", { CLaimID: ClaimID }, function (data) {
            $("#Loadingg").hide();

            if (data == "Done") {
                Swal.fire("Success", "Invoice is Deleted Successfuly", "success");
                $('#Search').click();
            }
            else if (data == "Error") {
                Swal.fire("Warning !", "Make Error In This Claim", "warning");
            }
            else {
                var batchNumber = data[0];
                var RecDate = moment(data[1]).format("DD-MM-YYYY");

                var errortext = "Claim Can not Deleted Because Claim are Sent To Tristar Accounting To Pay <br> Batch Number : " + batchNumber + "<br> Batch Date : " + RecDate;
                Swal.fire("Warning !", errortext, "warning");

            }

        })


        }
        });
    }
</script>





<script type="text/javascript">
    //const periodeValue = document.querySelector('.periode-value');
    const picker = new DateRangePicker('#daterange', {
        start: Date.now()/*"2022-01-01"*/,
        end: Date.now()/* "2022-09-19"*/,
        //onchange: (start, end) => {
        //    periodeValue.innerHTML = `
        //                    Début: ${start}
        //                    <br/>
        //                    Fin: ${end}
        //                `;
        //},
        //args: []
    });
</script>


<script type="text/javascript">
    function sleep(ms) {
        return new Promise(
            resolve => setTimeout(resolve, ms)
        );


    }
    $(function () {

        // Proxy created on the fly
        var cus = $.connection.cusHub;
        //var cus1 = $.connection.cusHub1;
        //console.log(cus)
        // Declare a function on the job hub so the server can invoke it
        cus.client.displayCustomer = function () {
            // async function a() {
            getData();
            //   await sleep(2000);
            //  getData1();
            //}
            //a();

            //getData();
            //getData1();
        };
        cus.client.data = function () {
            //async function a() {
            //    getData();
            //    await sleep(2000);
            getData1();
            //}
            //a();

            //getData();
            //getData1();
        };

        cus.client.data1 = function () {
            getData2();
        };
        // Start the connection
        $.connection.hub.start();
        getData();
        getData1();
        getData2();
        //async function aa() {
        //    getData();
        //    await sleep(2000);
        //    getData1();
        //}
        //aa();

    });
    function getData1() {
        try {

        //var $tbl = $('#tblInfo');
        $.ajax({
            url: /*"/Customer/Send_to_payy"*/ $("#Getmessages").val(),
            type: 'GET',
            datatype: 'json',
            success: function (data1) {

                $.get("/ClaimForm/getcountmessage", {/* Provider_id: $('#providerID').val(), Branch_id: $('#BranchID').val()*/ }, function (data) {
                    if (data == 0) {
                        $('#MesaageCount').removeAttr("data-count");

                    }
                    else {
                        $('#MesaageCount').attr("data-count", data);
                    }
                    // console.log(data);
                });


                $.each(data1.listCus, function (i, model) {

                });
            }
            });
        }
        catch (err) {
        }
    }

    function getData() {
        try {

        $.ajax({
            url: /*"/Customer/Send_to_payy"*/ $("#Get").val(),
            type: 'GET',
            datatype: 'json',
            success: function (data) {

                var provid = 0;
                var branchid = 0;
                if ("@Session["providerid"]" != "" &&"@Session["BranchID"]" != "") {
                     provid = parseInt("@Session["providerid"]");
                     branchid = parseInt("@Session["BranchID"]");
                }
                  var ApprovePage = 0;

                if ("@Session["ClaimForm_Approved"]" != "" ) {
                     ApprovePage = parseInt("@Session["ClaimForm_Approved"]");
                }
                //alert(provid);
                //alert(branchid);

                @*alert("@Session["providerid"]");
                alert(data.ProviderID);*@

                //$tbl.empty();
                $.get("/ClaimForm/getcountallert", {}, function (data1) {
                    if (data1 == 0) {
                        $('#NotifactionCount').removeAttr("data-count");

                    }
                    else {
                        $('#NotifactionCount').attr("data-count", data1);
                    }
                });

                $.each(data.listCus, function (i, model) {

                    //if ((provid == model.ProviderID) && (branchid == model.BranchID)) {
                    //}
                    if ((provid == model.ProviderID) && (branchid == model.BranchID) && (model.CardNumber != "0") && (model.ClaimFormNum != 0) && ($('#trigger').val() == "0") && (ApprovePage == 1)) {
                        $('#trigger').val("1");
                        $.connection.hub.disconnected(function () {
                            setTimeout(function () {
                                $.connection.hub.start();
                            }, 5000); // Restart connection after 5 seconds.
                        });
                        $.get("/ClaimForm/DeactiveAlert", {}, function (data2) {

                        @*var result = confirm("You Currently Reiceve Approval From CMC \n For Card Number is : " + model.CardNumber + "\n Claim Form Is :" + model.ClaimFormNum + " \n Are you Sure you want to Go ClaimForm Approved ?");
                        if (result == true) {
                                window.open('@Url.Action("ProviderClaimFormApproved", "ClaimForm")', '_self');
                        }
                        else {

                        }
                            $('#trigger').val("0");*@
                                    if ("@Session["ClaimForm_Approved"]"!="") {
                                    ClaimForm_Approv = parseInt("@Session["ClaimForm_Approved"]");
                                   if (ClaimForm_Approv == 1) {
                                       var sound = new Audio('/Media/alert.mp3');
                                       sound.autoplay = true;
                                       sound.muted = false;
                                       sound.play();
                                       setTimeout(function () {
                                           snackbar.classList.add('isShown');
                                           $('#CardNumbersnackbar').text(model.CardNumber)
                                           $('#Claimformsnackbar').text(model.ClaimFormNum)
                                           setTimeout(hideSnackbar, 5000);
                                    @*var result = confirm("You Currently Reiceve Approval From CMC \n For Card Number is : " + model.CardNumber + "\n Claim Form Is :" + model.ClaimFormNum + " \n Are you Sure you want to Go ClaimForm Approved ?");
                                        if (result == true) {
                                                    window.open('@Url.Action("ProviderClaimFormApproved", "ClaimForm")', '_self');
                                       }
                                       else {

                                       }*@
                                       $('#trigger').val("0");
                                           if (data2 == 0) {
                                           $('#NotifactionCount').removeAttr("data-count");

                                       }
                                       else {
                                               $('#NotifactionCount').attr("data-count", data2);
                                           }
                                       }, 100);
                                }
                                 }
                        })
                        //alert("You Currently Reiceve Approval From CMC \n For Card Number is : " + model.CardNumber +"\n Claim Form Is :"+model.ClaimFormNum);

                    }
                    //$tbl.append
                    //    (
                    //    '<tr>' +
                    //        '<td>' + model.ClaimFormNum + '</td>' +
                    //        '<td>' + model.CardNumber + '</td>' +
                    //        '<td>' + model.ProviderID + '</td>' +
                    //        '<td>' + model.BranchID + '</td>' +
                    //    '<tr>'
                    //    );
                });
            }
        });
    }
        catch (err) {
    }
    }
    function getData2() {
        try {

        $.ajax({
            url: /*"/Customer/Send_to_payy"*/ $("#Get1").val(),
            type: 'GET',
            datatype: 'json',
            success: function (data) {

                var provid = 0;
                var branchid = 0;
                if ("@Session["providerid"]" != "" &&"@Session["BranchID"]" != "") {
                     provid = parseInt("@Session["providerid"]");
                     branchid = parseInt("@Session["BranchID"]");
                }
                  var ApprovePage = 0;
                  var ApprovePage1 = 0;
                  var ApprovePage2 = 0;

                if ("@Session["ClaimForm_Approved"]" != ""||"@Session["Approval"]" != ""||"@Session["Doctor_ClaimForm"]" != "" ) {
                     ApprovePage = parseInt("@Session["ClaimForm_Approved"]");
                     ApprovePage1 = parseInt("@Session["Approval"]");
                     ApprovePage2 = parseInt("@Session["Doctor_ClaimForm"]");
                }

                $.get("/ClaimForm/getcountallertSmartCard", {}, function (data1) {
                    if (data1 == 0) {
                        $('#MemberSmartCardRequestsCount').removeAttr("data-count");

                    }
                    else {
                        $('#MemberSmartCardRequestsCount').attr("data-count", data1);
                    }
                });
                $.each(data.listCus, function (i, model) {

                    //if ((provid == model.ProviderID) && (branchid == model.BranchID)) {
                    //}
                    if ((provid == model.ProviderID) && (branchid == model.BranchID) && (model.CardNumber != "0")  && ($('#trigger1').val() == "0") && (ApprovePage == 1||ApprovePage1 == 1||ApprovePage2 == 1)) {
                        $('#trigger1').val("1");
                        $.connection.hub.disconnected(function () {
                            setTimeout(function () {
                                $.connection.hub.start();
                            }, 5000); // Restart connection after 5 seconds.
                        });

                        $.get("/ClaimForm/DeactiveAlertSmartCard", {}, function (data2) {

                        //var result = confirm("You Currently Reiceve Approval From CMC \n For Card Number is : " + model.CardNumber + "\n Claim Form Is :" + model.ClaimFormNum + " \n Are you Sure you want to Go ClaimForm Approved ?");

                            //if (result == true) {
                            var sound = new Audio('/Media/alert.mp3');
                            sound.play();
                            setTimeout(function () {
                                snackbarMember.classList.add('isShown');
                                $('#CardNumbersnackbarMember').text(model.CardNumber)
                                setTimeout(hideSnackbard1, 5000);
                           // alert("You Currently Reiceve Approval From CMC \n For Card Number is : " + model.CardNumber + "\n Claim Form Is :" + model.ClaimFormNum );
                               // window.open('@Url.Action("ProviderClaimFormApproved", "ClaimForm")', '_self');
                        //}
                        //else {

                        //}
                            $('#trigger1').val("0");
                                if (data2 == 0) {
                                $('#MemberSmartCardRequestsCount').removeAttr("data-count");

                            }
                            else {
                                    $('#MemberSmartCardRequestsCount').attr("data-count", data2);
                                }
                            }, 100);

                        })
                        //alert("You Currently Reiceve Approval From CMC \n For Card Number is : " + model.CardNumber +"\n Claim Form Is :"+model.ClaimFormNum);

                    }
                    //$tbl.append
                    //    (
                    //    '<tr>' +
                    //        '<td>' + model.ClaimFormNum + '</td>' +
                    //        '<td>' + model.CardNumber + '</td>' +
                    //        '<td>' + model.ProviderID + '</td>' +
                    //        '<td>' + model.BranchID + '</td>' +
                    //    '<tr>'
                    //    );
                });
            }
            });
        }
        catch (err) {
        }
    }
</script>

<script>


    function refresh() {

              $.ajax({
                        type: "POST",
                        url: "/ClaimForm/CheckIfSessionValid",
                        //data: JSON.stringify(Claims_Services),
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function (r) {
                            if (r == "False") {
                                window.open('@Url.Action("login", "ClaimForm")', '_self');
                            }
                            else {
                                setTimeout(refresh, 5000);
                                 }
                        }
        });

    }

    setTimeout(refresh, 1000);
</script>


